# Internationalization JavaScript Documentation

## Introduction

The `js/i18n.js` file implements a comprehensive internationalization (i18n) system for the SGP Yoga website through the `SGPi18n` class. This advanced system provides several key features:

- **Dynamic Translation Loading**: Asynchronous loading of translation files organized by namespace
- **i18next Integration**: Seamless integration with the popular i18next library while maintaining fallback functionality
- **Namespace Management**: Modular organization of translations by page/feature (common, home, classes, etc.)
- **Language Detection**: Intelligent detection of user language preferences
- **Persistent Preferences**: Storage of user language choices in localStorage
- **Fallback System**: Robust fallback mechanisms for missing translations
- **DOM Content Updates**: Automatic updating of all translatable elements on language change
- **Accessibility Support**: Proper handling of ARIA labels, placeholders, and meta descriptions

The system is designed to work both with and without i18next, providing flexibility and reliability. It follows modern JavaScript patterns with ES6 classes, async/await, and Promise-based operations.

## Class Structure

### SGPi18n Class
```javascript
class SGPi18n {
    constructor() {
        this.currentLanguage = 'en';
        this.supportedLanguages = ['en', 'es'];
        this.loadedNamespaces = new Set();
        this.translations = {};
        this.fallbackTranslations = {};
        this.isInitialized = false;
    }
}
```

**Purpose**: Main class that encapsulates all internationalization functionality.

**Properties**:
- **currentLanguage**: Currently active language code
- **supportedLanguages**: Array of supported language codes ['en', 'es']
- **loadedNamespaces**: Set of successfully loaded translation namespaces
- **translations**: Object storing all loaded translations organized by language and namespace
- **fallbackTranslations**: Reserved for embedded fallback translations
- **isInitialized**: Boolean flag indicating system readiness

---

## Method Documentation

### Initialization System

#### init(options = {})
```javascript
async init(options = {}) {
    const {
        namespaces = ['common'],
        defaultLang = 'en'
    } = options;

    try {
        // Detect initial language
        this.currentLanguage = this.detectLanguage(defaultLang);
        
        // Load initial namespaces
        await this.loadNamespaces(namespaces);
        
        // Initialize i18next if available
        if (typeof i18next !== 'undefined') {
            await this.initI18next();
        }
        
        this.isInitialized = true;
        
        // Update navbar and content
        this.updateNavbarLanguageDisplay();
        this.updatePageContent();
        
        console.log('SGP i18n initialized successfully');
    } catch (error) {
        console.warn('SGP i18n initialization failed:', error);
        // Fall back to embedded translations if available
        this.isInitialized = true;
    }
}
```

**Purpose**: Main initialization method that sets up the entire i18n system.

**Parameters**:
- **options.namespaces** (Array): Translation namespaces to preload (default: ['common'])
- **options.defaultLang** (string): Default language fallback (default: 'en')

**Process Flow**:
1. **Language Detection**: Determines user's preferred language
2. **Namespace Loading**: Asynchronously loads specified translation namespaces
3. **i18next Integration**: Initializes i18next library if available
4. **UI Updates**: Updates navbar language display and page content
5. **Error Handling**: Graceful fallback on initialization failure

**Usage Example**:
```javascript
// Basic initialization
await sgpI18n.init();

// Advanced initialization
await sgpI18n.init({
    namespaces: ['common', 'home', 'classes'],
    defaultLang: 'es'
});
```

**Triggered**: Called during DOMContentLoaded event (line 376).

---

#### detectLanguage(defaultLang)
```javascript
detectLanguage(defaultLang) {
    const storedLang = localStorage.getItem('selectedLanguage');
    const browserLang = navigator.language.toLowerCase();
    const detectedLang = storedLang || (browserLang.startsWith('es') ? 'es' : defaultLang);
    
    return this.supportedLanguages.includes(detectedLang) ? detectedLang : defaultLang;
}
```

**Purpose**: Intelligent detection of user's preferred language with multiple fallback layers.

**Detection Priority**:
1. **Stored Preference**: localStorage 'selectedLanguage' value (highest priority)
2. **Browser Language**: navigator.language detection for Spanish variants
3. **Default Language**: Provided default language (final fallback)

**Logic Examples**:
- localStorage: 'es' â†’ Spanish
- Browser: 'es-MX' â†’ Spanish (Mexico)
- Browser: 'es-ES' â†’ Spanish (Spain)
- Browser: 'en-US' â†’ English
- Browser: 'fr-FR' + defaultLang: 'en' â†’ English (unsupported language fallback)

**Validation**: Ensures detected language is in `supportedLanguages` array.

**Returns**: Valid language code ('en' or 'es').

---

### Translation Loading System

#### loadNamespaces(namespaces)
```javascript
async loadNamespaces(namespaces) {
    const loadPromises = [];
    
    for (const namespace of namespaces) {
        if (!this.loadedNamespaces.has(namespace)) {
            loadPromises.push(this.loadNamespace(namespace));
        }
    }
    
    await Promise.all(loadPromises);
}
```

**Purpose**: Efficiently loads multiple translation namespaces in parallel.

**Logic**:
- Checks `loadedNamespaces` Set to avoid duplicate loading
- Creates Promise array for parallel loading
- Uses `Promise.all()` for concurrent execution

**Performance Benefits**:
- Prevents duplicate network requests
- Parallel loading reduces initialization time
- Handles partial failures gracefully

**Example Usage**:
```javascript
// Load multiple namespaces
await sgpI18n.loadNamespaces(['common', 'classes', 'events']);

// Namespaces already loaded are skipped automatically
await sgpI18n.loadNamespaces(['common', 'blog']); // Only 'blog' loads
```

---

#### loadNamespace(namespace)
```javascript
async loadNamespace(namespace) {
    try {
        const loadPromises = this.supportedLanguages.map(lang => 
            this.loadTranslationFile(lang, namespace)
        );
        
        await Promise.all(loadPromises);
        this.loadedNamespaces.add(namespace);
        
        console.log(`Loaded namespace: ${namespace}`);
    } catch (error) {
        console.warn(`Failed to load namespace ${namespace}:`, error);
    }
}
```

**Purpose**: Loads a single namespace for all supported languages.

**Process**:
1. Creates loading promises for each supported language
2. Executes all language loads in parallel
3. Marks namespace as loaded in `loadedNamespaces` Set
4. Logs success or failure appropriately

**File Structure Expected**:
```
locales/
â”œâ”€â”€ en/
â”‚   â”œâ”€â”€ common.json
â”‚   â”œâ”€â”€ home.json
â”‚   â””â”€â”€ classes.json
â””â”€â”€ es/
    â”œâ”€â”€ common.json
    â”œâ”€â”€ home.json
    â””â”€â”€ classes.json
```

---

#### loadTranslationFile(language, namespace)
```javascript
async loadTranslationFile(language, namespace) {
    try {
        const response = await fetch(`locales/${language}/${namespace}.json`);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const translations = await response.json();
        
        // Initialize language object if not exists
        if (!this.translations[language]) {
            this.translations[language] = {};
        }
        
        // Store translations under namespace
        this.translations[language][namespace] = translations;
        
    } catch (error) {
        console.warn(`Failed to load ${language}/${namespace}.json:`, error);
    }
}
```

**Purpose**: Loads and parses individual translation files from the server.

**Error Handling**:
- HTTP status code validation
- JSON parsing error handling
- Graceful failure with warning logs

**Data Structure**:
```javascript
// Resulting this.translations structure:
{
    "en": {
        "common": { "welcome": "Welcome", "about": "About" },
        "home": { "hero_title": "SGP Yoga Studio" }
    },
    "es": {
        "common": { "welcome": "Bienvenido", "about": "Acerca de" },
        "home": { "hero_title": "Estudio de Yoga SGP" }
    }
}
```

**File Path Pattern**: `locales/{language}/{namespace}.json`

---

### i18next Integration

#### initI18next()
```javascript
async initI18next() {
    const resources = {};
    
    // Convert our translation structure to i18next format
    for (const lang of this.supportedLanguages) {
        resources[lang] = {};
        
        if (this.translations[lang]) {
            for (const namespace in this.translations[lang]) {
                resources[lang][namespace] = this.translations[lang][namespace];
            }
        }
    }

    return i18next
        .use(i18nextBrowserLanguageDetector)
        .init({
            debug: false,
            lng: this.currentLanguage,
            fallbackLng: 'en',
            defaultNS: 'common',
            ns: Array.from(this.loadedNamespaces),
            detection: {
                order: ['localStorage', 'navigator', 'htmlTag'],
                lookupLocalStorage: 'selectedLanguage',
                caches: ['localStorage'],
            },
            resources
        });
}
```

**Purpose**: Configures and initializes i18next library with loaded translations.

**Configuration Options**:
- **debug**: Disabled for production
- **lng**: Current detected language
- **fallbackLng**: English as universal fallback
- **defaultNS**: 'common' namespace as default
- **ns**: Array of loaded namespaces
- **detection**: Language detection strategy
- **resources**: Converted translation data

**Translation Format Conversion**:
```javascript
// SGPi18n format:
this.translations = {
    "en": { "common": {...}, "home": {...} }
}

// i18next format:
resources = {
    "en": { "common": {...}, "home": {...} }
}
```

**Detection Strategy Priority**:
1. localStorage ('selectedLanguage')
2. Browser navigator.language
3. HTML lang attribute

---

### Translation Retrieval

#### t(key, defaultText = '')
```javascript
t(key, defaultText = '') {
    // Use i18next if available and initialized
    if (typeof i18next !== 'undefined' && i18next.isInitialized) {
        return i18next.t(key, defaultText);
    }
    
    // Parse namespace and key
    const [namespace, keyPath] = this.parseKey(key);
    
    // Get translation from our loaded translations
    const translation = this.getNestedTranslation(
        this.translations[this.currentLanguage]?.[namespace], 
        keyPath
    );
    
    if (translation) return translation;
    
    // Fallback to English
    const fallback = this.getNestedTranslation(
        this.translations['en']?.[namespace], 
        keyPath
    );
    
    return fallback || defaultText || key;
}
```

**Purpose**: Core translation function that retrieves translated text for given keys.

**Fallback Strategy**:
1. **i18next**: Use i18next.t() if available and initialized (preferred)
2. **Current Language**: Look up in current language translations
3. **English Fallback**: Fall back to English translations
4. **Default Text**: Use provided default text
5. **Key Return**: Return original key as last resort

**Key Format Examples**:
```javascript
// Namespace specified
sgpI18n.t('common:welcome'); // â†’ "Welcome" or "Bienvenido"
sgpI18n.t('home:hero.title'); // â†’ Nested key access

// Default namespace (common)
sgpI18n.t('welcome'); // â†’ Uses 'common' namespace

// With default text
sgpI18n.t('missing_key', 'Default Text'); // â†’ "Default Text" if key missing
```

**Integration with DOM**:
```html
<!-- HTML usage -->
<h1 data-i18n="home:hero.title">Welcome to SGP Yoga</h1>

<!-- JavaScript usage -->
element.textContent = sgpI18n.t('common:welcome');
```

---

#### parseKey(key)
```javascript
parseKey(key) {
    if (key.includes(':')) {
        const [namespace, keyPath] = key.split(':', 2);
        return [namespace, keyPath];
    }
    
    // Default to 'common' namespace
    return ['common', key];
}
```

**Purpose**: Parses translation keys to extract namespace and key path components.

**Key Format Parsing**:
- `'common:welcome'` â†’ `['common', 'welcome']`
- `'home:hero.title'` â†’ `['home', 'hero.title']`
- `'welcome'` â†’ `['common', 'welcome']` (default namespace)
- `'nav:menu.about.title'` â†’ `['nav', 'menu.about.title']`

**Namespace Default**: Keys without ':' automatically use 'common' namespace.

**Limitation**: Only splits on first ':' to handle potential colons in key paths.

---

#### getNestedTranslation(obj, keyPath)
```javascript
getNestedTranslation(obj, keyPath) {
    if (!obj) return null;
    
    const keys = keyPath.split('.');
    let current = obj;
    
    for (const k of keys) {
        if (current && typeof current === 'object' && k in current) {
            current = current[k];
        } else {
            return null;
        }
    }
    
    return typeof current === 'string' ? current : null;
}
```

**Purpose**: Safely traverses nested translation objects using dot-notation key paths.

**Dot-notation Examples**:
```javascript
// Translation object:
{
    "hero": {
        "title": "Welcome to SGP Yoga",
        "subtitle": {
            "main": "Find Your Inner Peace"
        }
    }
}

// Key path traversal:
getNestedTranslation(obj, 'hero.title') â†’ "Welcome to SGP Yoga"
getNestedTranslation(obj, 'hero.subtitle.main') â†’ "Find Your Inner Peace"
getNestedTranslation(obj, 'hero.missing') â†’ null
```

**Safety Features**:
- Null/undefined object handling
- Type checking at each level
- Returns null for missing keys
- Only returns string values (not objects)

---

### Language Management

#### changeLanguage(languageCode)
```javascript
async changeLanguage(languageCode) {
    if (!this.supportedLanguages.includes(languageCode)) {
        console.warn('Unsupported language:', languageCode);
        return;
    }

    const previousLang = this.currentLanguage;
    this.currentLanguage = languageCode;

    try {
        // Update i18next if available
        if (typeof i18next !== 'undefined' && i18next.isInitialized) {
            await i18next.changeLanguage(languageCode);
        }

        // Update localStorage and HTML attributes
        localStorage.setItem('selectedLanguage', languageCode);
        document.documentElement.setAttribute('lang', languageCode);
        document.documentElement.setAttribute('data-lang', languageCode);

        // Update UI
        this.updateNavbarLanguageDisplay();
        this.updatePageContent();

        console.log(`Language changed from ${previousLang} to ${languageCode}`);
    } catch (error) {
        console.error('Error changing language:', error);
        this.currentLanguage = previousLang; // Revert on error
    }
}
```

**Purpose**: Complete language switching workflow with error handling and state management.

**Process Flow**:
1. **Validation**: Ensures language is supported
2. **State Update**: Changes current language
3. **i18next Sync**: Updates i18next if available
4. **Persistence**: Stores choice in localStorage
5. **HTML Attributes**: Updates document language attributes
6. **UI Updates**: Refreshes navbar and page content
7. **Error Handling**: Reverts to previous language on failure

**State Management**:
- Tracks previous language for error recovery
- Atomic updates (all or nothing)
- Comprehensive logging

**DOM Updates**:
```html
<!-- Before -->
<html lang="en" data-lang="en">

<!-- After changeLanguage('es') -->
<html lang="es" data-lang="es">
```

**Triggered By**:
- Navbar language selection
- Programmatic language changes
- External integrations

---

#### loadNamespacesOnDemand(namespaces)
```javascript
async loadNamespacesOnDemand(namespaces) {
    await this.loadNamespaces(namespaces);
    
    // Update i18next with new namespaces if available
    if (typeof i18next !== 'undefined' && i18next.isInitialized) {
        const resources = {};
        
        for (const lang of this.supportedLanguages) {
            resources[lang] = {};
            for (const namespace of namespaces) {
                if (this.translations[lang]?.[namespace]) {
                    resources[lang][namespace] = this.translations[lang][namespace];
                }
            }
        }
        
        // Add resources to i18next
        for (const lang of this.supportedLanguages) {
            for (const namespace of namespaces) {
                if (resources[lang][namespace]) {
                    i18next.addResourceBundle(lang, namespace, resources[lang][namespace]);
                }
            }
        }
    }
    
    // Update page content with new translations
    this.updatePageContent();
}
```

**Purpose**: Dynamically loads additional translation namespaces after initial setup.

**Use Cases**:
- Page-specific translations (classes.json when visiting classes page)
- Feature-specific translations (blog.json when accessing blog)
- Progressive loading for performance optimization

**Process**:
1. **Load Translations**: Uses existing `loadNamespaces()` method
2. **i18next Integration**: Adds new resources to i18next using `addResourceBundle()`
3. **Content Update**: Refreshes page with newly available translations

**Example Usage**:
```javascript
// Load blog-specific translations when entering blog section
await sgpI18n.loadNamespacesOnDemand(['blog']);

// Now blog translations are available
sgpI18n.t('blog:post.read_more'); // â†’ "Read More" or "Leer MÃ¡s"
```

---

### UI Update System

#### updateNavbarLanguageDisplay()
```javascript
updateNavbarLanguageDisplay() {
    const currentFlag = document.getElementById('currentFlag');
    const currentLangCode = document.getElementById('currentLangCode');
    
    if (!currentFlag || !currentLangCode) return;
    
    const languages = {
        'en': { flag: 'ðŸ‡ºðŸ‡¸', code: 'EN' },
        'es': { flag: 'ðŸ‡²ðŸ‡½', code: 'ES' }
    };
    
    const selectedLang = languages[this.currentLanguage];
    if (selectedLang) {
        currentFlag.textContent = selectedLang.flag;
        currentLangCode.textContent = selectedLang.code;
    }
}
```

**Purpose**: Updates navbar language selector display elements.

**Dependencies**: Requires specific DOM elements with IDs:
- `currentFlag`: Element displaying flag emoji
- `currentLangCode`: Element displaying language code

**Language Display Mapping**:
- English: US flag ðŸ‡ºðŸ‡¸, code "EN"
- Spanish: Mexican flag ðŸ‡²ðŸ‡½, code "ES" (appropriate for CDMX location)

**Error Handling**: Gracefully handles missing DOM elements.

**Integration**:
```html
<!-- Expected HTML structure -->
<button id="languageToggle">
    <span id="currentFlag">ðŸ‡ºðŸ‡¸</span>
    <span id="currentLangCode">EN</span>
</button>
```

---

#### updatePageContent()
```javascript
updatePageContent() {
    // Update elements with data-i18n attribute
    const elementsToTranslate = document.querySelectorAll('[data-i18n]');
    elementsToTranslate.forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translatedText = this.t(key, element.textContent);
        element.textContent = translatedText;
    });

    // Update page title
    const titleElement = document.querySelector('title[data-i18n]');
    if (titleElement) {
        const titleKey = titleElement.getAttribute('data-i18n');
        document.title = this.t(titleKey, document.title);
    }

    // Update meta descriptions
    const metaDescriptions = document.querySelectorAll('meta[name="description"][data-i18n]');
    metaDescriptions.forEach(meta => {
        const key = meta.getAttribute('data-i18n');
        meta.setAttribute('content', this.t(key, meta.getAttribute('content')));
    });

    // Update placeholders
    const elementsWithPlaceholders = document.querySelectorAll('[data-i18n-placeholder]');
    elementsWithPlaceholders.forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        element.setAttribute('placeholder', this.t(key, element.getAttribute('placeholder')));
    });

    // Update aria-labels
    const elementsWithAriaLabels = document.querySelectorAll('[data-i18n-aria-label]');
    elementsWithAriaLabels.forEach(element => {
        const key = element.getAttribute('data-i18n-aria-label');
        element.setAttribute('aria-label', this.t(key, element.getAttribute('aria-label')));
    });
}
```

**Purpose**: Comprehensive update of all translatable content on the page.

**Supported Translation Attributes**:

1. **data-i18n**: Text content translation
```html
<h1 data-i18n="home:hero.title">Welcome to SGP Yoga</h1>
<p data-i18n="common:description">Best yoga studio in CDMX</p>
```

2. **data-i18n (title)**: Page title translation
```html
<title data-i18n="home:page_title">SGP Yoga - Home</title>
```

3. **data-i18n (meta description)**: SEO meta description translation
```html
<meta name="description" content="Yoga studio in CDMX" data-i18n="home:meta_description">
```

4. **data-i18n-placeholder**: Input placeholder translation
```html
<input type="email" placeholder="Enter your email" data-i18n-placeholder="forms:email_placeholder">
```

5. **data-i18n-aria-label**: Accessibility label translation
```html
<button aria-label="Close dialog" data-i18n-aria-label="common:close">Ã—</button>
```

**Fallback Behavior**: Uses current content as fallback if translation is missing.

**SEO Benefits**: Proper meta description and title translations for search engine optimization.

---

### Utility Methods

#### getCurrentLanguage()
```javascript
getCurrentLanguage() {
    return this.currentLanguage;
}
```

**Purpose**: Simple getter method for current language state.

**Returns**: Current language code ('en' or 'es').

**Usage Examples**:
```javascript
// Check current language
if (sgpI18n.getCurrentLanguage() === 'es') {
    // Spanish-specific logic
}

// Dynamic content loading
const currentLang = sgpI18n.getCurrentLanguage();
loadLanguageSpecificContent(currentLang);
```

---

## Global Initialization and Event Handling

### DOM Content Loaded Handler
```javascript
document.addEventListener('DOMContentLoaded', async function() {
    await sgpI18n.init({
        namespaces: ['common', 'home'],
        defaultLang: 'en'
    });
});
```

**Purpose**: Automatic initialization when page loads.

**Default Configuration**:
- Preloads 'common' and 'home' namespaces
- Sets English as default language
- Handles initialization asynchronously

---

### Language Change Event Handler
```javascript
document.addEventListener('languageChanged', function(event) {
    const newLanguage = event.detail.language;
    sgpI18n.changeLanguage(newLanguage);
});
```

**Purpose**: Responds to language change events from navbar system.

**Integration**: Connects with navbar.js language selection events.

**Event Structure**:
```javascript
// Event dispatched by navbar.js
const languageChangeEvent = new CustomEvent('languageChanged', {
    detail: { language: 'es' }
});
```

---

### Global Export
```javascript
if (typeof window !== 'undefined') {
    window.SGPi18n = sgpI18n;
}
```

**Purpose**: Makes SGPi18n instance available globally for external use.

**Available Global Methods**:
```javascript
// Global access
window.SGPi18n.t('common:welcome');
window.SGPi18n.changeLanguage('es');
window.SGPi18n.getCurrentLanguage();
window.SGPi18n.loadNamespacesOnDemand(['blog']);
```

---

## Translation File Structure

### Expected File Organization
```
locales/
â”œâ”€â”€ en/
â”‚   â”œâ”€â”€ common.json    # Shared translations (navbar, footer, common UI)
â”‚   â”œâ”€â”€ home.json      # Homepage-specific translations
â”‚   â”œâ”€â”€ classes.json   # Classes page translations
â”‚   â”œâ”€â”€ events.json    # Events page translations
â”‚   â””â”€â”€ blog.json      # Blog page translations
â””â”€â”€ es/
    â”œâ”€â”€ common.json
    â”œâ”€â”€ home.json
    â”œâ”€â”€ classes.json
    â”œâ”€â”€ events.json
    â””â”€â”€ blog.json
```

### Translation File Format
```json
// locales/en/common.json
{
    "nav": {
        "home": "Home",
        "about": "About",
        "classes": "Classes",
        "events": "Events",
        "blog": "Blog"
    },
    "buttons": {
        "learn_more": "Learn More",
        "contact_us": "Contact Us",
        "book_now": "Book Now"
    },
    "forms": {
        "email_placeholder": "Enter your email",
        "name_placeholder": "Your full name",
        "submit": "Submit"
    }
}
```

```json
// locales/en/home.json
{
    "hero": {
        "title": "Find Your Inner Peace",
        "subtitle": "Experience authentic yoga in the heart of CDMX",
        "cta": "Start Your Journey"
    },
    "about": {
        "title": "About SGP Yoga",
        "description": "We offer traditional yoga practices in modern venues across Mexico City."
    }
}
```

---

## Integration Patterns

### HTML Integration
```html
<!DOCTYPE html>
<html lang="en" data-lang="en">
<head>
    <title data-i18n="home:page_title">SGP Yoga - Find Your Inner Peace</title>
    <meta name="description" content="Yoga studio in CDMX" data-i18n="home:meta_description">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <a href="/" data-i18n="common:nav.home">Home</a>
        <a href="/about.html" data-i18n="common:nav.about">About</a>
        <a href="/classes.html" data-i18n="common:nav.classes">Classes</a>
    </nav>
    
    <!-- Main content -->
    <main>
        <h1 data-i18n="home:hero.title">Find Your Inner Peace</h1>
        <p data-i18n="home:hero.subtitle">Experience authentic yoga</p>
        
        <!-- Form with placeholders -->
        <form>
            <input type="text" data-i18n-placeholder="common:forms.name_placeholder">
            <input type="email" data-i18n-placeholder="common:forms.email_placeholder">
            <button type="submit" data-i18n="common:buttons.submit">Submit</button>
        </form>
        
        <!-- Accessibility -->
        <button aria-label="Close" data-i18n-aria-label="common:close">Ã—</button>
    </main>
</body>
</html>
```

### JavaScript Integration
```javascript
// Manual translation
document.querySelector('.dynamic-content').textContent = sgpI18n.t('home:hero.title');

// Conditional content based on language
if (sgpI18n.getCurrentLanguage() === 'es') {
    loadSpanishSpecificContent();
}

// Dynamic namespace loading
async function loadBlogPage() {
    await sgpI18n.loadNamespacesOnDemand(['blog']);
    updateBlogContent();
}

// Event-driven updates
document.addEventListener('languageChanged', function() {
    updateCustomComponents();
});
```

### CSS Integration
```css
/* Language-specific styling */
html[data-lang="es"] .price::after {
    content: " MXN";
}

html[data-lang="en"] .price::after {
    content: " USD";
}

/* RTL/LTR support (if needed) */
html[data-lang="ar"] {
    direction: rtl;
}
```

---

## Performance Considerations

### Optimization Strategies

**Lazy Loading**:
```javascript
// Load page-specific translations only when needed
await sgpI18n.loadNamespacesOnDemand(['classes']);
```

**Caching**:
- Translation files cached by browser after first load
- Namespace tracking prevents duplicate requests
- localStorage persistence reduces detection overhead

**Parallel Loading**:
- Multiple translation files load simultaneously
- Promise.all() for efficient batch operations
- Non-blocking initialization

### Bundle Size Impact
- Core i18n system: ~8KB minified
- Each translation file: ~2-5KB
- Total initial load: ~15-20KB (common + home namespaces)

---

## Error Handling and Fallbacks

### Robust Fallback Chain
1. **i18next Translation**: Primary translation method
2. **SGPi18n Translation**: Fallback translation system
3. **Current Language**: User's selected language
4. **English Fallback**: Universal fallback language
5. **Default Text**: Provided default text
6. **Key Display**: Original translation key (last resort)

### Network Failure Handling
- Graceful degradation when translation files fail to load
- Console warnings for debugging
- System remains functional with partial translations

### Validation and Safety
- Language code validation before switching
- DOM element existence checking
- Type checking for nested translations
- Error recovery in language change operations

---

## Browser Compatibility

### Required Features
- **ES6 Classes**: Modern class syntax
- **Async/Await**: Promise-based operations
- **Fetch API**: Translation file loading
- **Set Data Structure**: Namespace tracking
- **Custom Events**: Language change notifications
- **localStorage**: Preference persistence

### Supported Browsers
- Chrome/Edge 55+
- Firefox 52+
- Safari 10.1+
- iOS Safari 10.3+
- Android Browser 76+

---

## Final Notes

### Maintenance Guidelines
- **Translation Keys**: Use descriptive, hierarchical naming
- **Namespace Organization**: Group by page or feature
- **File Structure**: Maintain consistent JSON structure across languages
- **Error Handling**: Monitor console warnings for missing translations

### Extensibility
- **Additional Languages**: Add to `supportedLanguages` array and create translation files
- **New Namespaces**: Simply create new JSON files and load them
- **Custom Attributes**: Extend `updatePageContent()` for new translation patterns
- **Integration Points**: Use global `SGPi18n` instance for external integrations

### Best Practices
- **Key Naming**: Use consistent, hierarchical key naming (`page:section.element`)
- **Fallback Text**: Always provide meaningful fallback text
- **Testing**: Test all language combinations and missing translation scenarios
- **Performance**: Load only necessary namespaces initially, use on-demand loading
- **Accessibility**: Ensure proper language attributes and ARIA label translations

This i18n implementation provides a robust, flexible foundation for the SGP Yoga website's multilingual needs while maintaining excellent performance and user experience.
