{# ========================================================================
   FEATURED POSTS SLIDESHOW COMPONENT
   ========================================================================
   
   Displays featured blog posts in a testimonial-style slideshow
   
   Usage:
   {% include "components/featured-posts.njk" %}
   
   Requirements:
   - Posts must have 'featured: true' in frontmatter
   - Required fields: featuredImage, featuredImageLow, featuredImageAlt
   - Optional fields: featuredOrder (for sorting), featuredExcerpt
   ======================================================================== #}

{% set featuredSlides = collections.featuredPosts %}

{# Only render if we have featured posts #}
{% if featuredSlides.length > 0 %}
<section class="featured-posts-section">
    <div class="container">
        <!-- Section Header -->
        <div class="featured-posts-header">
            <h1 data-i18n="blog:featured.title">Featured Posts</h1>
            <p data-i18n="blog:featured.subtitle">Discover our most popular insights and practices</p>
        </div>

        <!-- Slideshow Container -->
        <div class="featured-posts-slideshow" id="featuredPostsSlideshow">
            <div class="featured-posts-wrapper">
                {% for post in featuredSlides %}
                {# Determine if this is the first slide (for eager loading) #}
                {% set isFirstSlide = loop.index0 == 0 %}
                {% set loadingStrategy = "lazy" %}
                {% if isFirstSlide %}
                    {% set loadingStrategy = "eager" %}
                {% endif %}
                
                <!-- Featured Slide {{ loop.index }} -->
                <div class="featured-slide {% if isFirstSlide %}active{% endif %}" data-lang="{{ post.data.lang }}">
                    <!-- Photo Section -->
                    <div class="featured-photo">
                        <a href="{{ post.url | url }}" class="featured-photo-link" aria-label="Read {{ post.data.title }}">
                            <picture>
                                {# High-resolution for large screens #}
                                {% if post.data.featuredImage %}
                                <source 
                                    media="(min-width: 1200px)" 
                                    srcset="{{ post.data.featuredImage }}">
                                {% endif %}
                                
                                {# Standard/fallback resolution #}
                                <img 
                                    src="{{ post.data.featuredImageLow or post.data.featuredImage }}" 
                                    alt="{{ post.data.featuredImageAlt or post.data.title }}"
                                    loading="{{ loadingStrategy }}"
                                    class="featured-image">
                            </picture>
                        </a>
                    </div>
                    
                    <!-- Content Section -->
                    <div class="featured-content">
                        {# Category badge #}
                        {% if post.data.category %}
                        <div class="featured-category">{{ post.data.category }}</div>
                        {% endif %}
                        
                        {# Title (link to full post) #}
                        <h3 class="featured-title">
                            <a href="{{ post.url | url }}">
                                {{ post.data.title }}
                            </a>
                        </h3>
                        
                        {# Description/Excerpt #}
                        <p class="featured-description">
                            {{ post.data.featuredExcerpt or post.data.description }}
                        </p>
                        
                        {# Metadata: Date and Read More #}
                        <div class="featured-meta">
                            <time datetime="{{ post.date | htmlDateString }}">
                                {% if post.data.lang == 'es' %}
                                    {{ post.date | readableDateES }}
                                {% else %}
                                    {{ post.date | readableDate }}
                                {% endif %}
                            </time>
                            
                            <a href="{{ post.url | url }}" class="featured-read-more">
                                <span class="read-more-text">
                                    {% if post.data.lang == 'es' %}
                                        Leer m√°s
                                    {% else %}
                                        Read More
                                    {% endif %}
                                </span>
                                <i data-lucide="arrow-right" class="read-more-icon"></i>
                            </a>
                        </div>
                        
                        {# Tags (optional) #}
                        {% if post.data.tags %}
                        <div class="featured-tags">
                            {% for tag in post.data.tags | limit(3) %}
                                <span class="featured-tag">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Navigation Controls -->
            <div class="featured-posts-navigation">
                <button class="nav-btn" id="featured-posts-prev" aria-label="Previous featured post">
                    <i data-lucide="chevron-left"></i>
                </button>
                
                <div class="featured-posts-dots">
                    <!-- Dots will be generated by JavaScript -->
                </div>
                
                <button class="nav-btn" id="featured-posts-next" aria-label="Next featured post">
                    <i data-lucide="chevron-right"></i>
                </button>
            </div>
        </div>
        
        <!-- No featured posts message (hidden by default, shown by JavaScript if needed) -->
        <div class="no-featured-posts" id="noFeaturedPosts" style="display: none;">
            <p data-i18n="blog:featured.noPostsAvailable">No featured posts available in your selected language.</p>
        </div>
    </div>
</section>
{% else %}
{# Warn developers if no featured posts found #}
<!-- No featured posts found. Add 'featured: true' to post frontmatter. -->
{% endif %}
